{% extends "base.html" %}
{% block content %}

<style>
  .card-wide{ max-width:980px; text-align:left; }

  .pill{
    display:inline-flex;
    align-items:center;
    justify-content:center;
    gap:8px;
    padding:10px 14px;
    border-radius:999px;
    border:1px solid #d1d5db;
    background:#fff;
    color:#111827;
    font-weight:900;
    font-size:14px;
    cursor:pointer;
    text-decoration:none;
    user-select:none;
  }
  .pill:hover{ border-color:#9ca3af; }
  .dl-pill svg { flex: 0 0 auto; }

  .round-row{ display:flex; justify-content:center; gap:10px; flex-wrap:wrap; margin:10px 0 4px 0; }

  .round-pill{
    width:140px;
    height:140px;
    border-radius:20px;
    border:1.5px solid #d1d5db;
    background:#fff;
    padding:14px 14px;
    display:flex;
    flex-direction:column;
    align-items:flex-start;
    justify-content:flex-start;
    gap:6px;
    position:relative;
  }

  .round-pill:hover{ border-color:#9ca3af; }

  .round-pill.active{
    background:#4a6cf7;
    color:#fff;
    border-color:#4a6cf7;
  }
  .round-pill.active .round-title,
  .round-pill.active .round-sub{
    color:#fff;
  }

  .round-title{
    font-size:21px;
    font-weight:950;
    line-height:1.05;
    text-align:left;
  }
  .round-sub{
    font-size:21px;
    font-weight:300;
    color:#6b7280;
    line-height:1.05;
    text-align:left;
  }
    .round-result-btn{
    position:absolute;
    right:14px;
    bottom:14px;
    width:54px;
    height:54px;
    border-radius:14px;
    background:#ffffff;
    border:1.5px solid rgba(255,255,255,0.85);
    display:flex;
    align-items:center;
    justify-content:center;
    text-align:center;
    font-weight:950;
    font-size:14px;
    line-height:1.05;
    color:#4a6cf7;
    letter-spacing:-0.4px;
    user-select:none;
  }

  .round-pill.active .round-result-btn{
    border-color:rgba(255,255,255,0.9);
    background:#ffffff;
    color:#4a6cf7;
  }


  .panel{ margin-top:12px; border:1px solid #e5e7eb; border-radius:14px; background:#fff; overflow:hidden; }
  .panel-hd{ display:flex; align-items:center; justify-content:space-between; padding:14px 16px; background:#f8fafc; border-bottom:1px solid #eef2f7; }
  .panel-title{ font-weight:950; }
  .panel-sub{ color:#6b7280; font-weight:700; font-size:12px; }
  .panel-bd{ padding:14px 16px; }

  .step-row{ display:flex; gap:10px; flex-wrap:wrap; margin:10px 0 12px 0; align-items:center; }
  .step-btn{ border:1px solid #d1d5db; background:#fff; }
  .step-btn.active{ border-color:#111827; }

  .step-arrow{
    color:#9ca3af;
    font-weight:900;
    font-size:18px;
    user-select:none;
    margin:0 2px;
    line-height:1;
  }

  .content-box{ display:none; border:1px solid #e5e7eb; border-radius:14px; background:#fff; padding:14px; margin-top:10px; }
  .content-box.active{ display:block; }

  .section-title{ font-weight:950; margin:0 0 8px 0; }
  .subtitle{ color:#6b7280; font-weight:700; font-size:13px; line-height:1.4; }
  .guide-box .subtitle{font-weight: 400;}
  .note{ margin-top:10px; padding:10px 12px; background:#f8fafc; border:1px solid #eef2f7; border-radius:12px; font-weight:800; font-size:13px; color:#374151; }

  .two-col{ display:grid; grid-template-columns: 1fr 2fr; gap:12px; }
  @media(max-width: 600px){ .two-col{ grid-template-columns: 1fr; } }

  .qr-box{ background:#fff; border:1px solid #e5e7eb; border-radius:14px; padding:12px; text-align:center; }
  .qr-actions{ display:flex; gap:8px; justify-content:center; align-items:center; margin-top:8px; }
  .icon-btn{ width:30px; height:30px; border-radius:10px; border:1px solid #e5e7eb; background:#fff; cursor:pointer; font-size:16px; line-height:1; display:inline-flex; align-items:center; justify-content:center; }
  .icon-btn:hover{ border-color:#9ca3af; }

  .student-list{ background:#fff; border:1px solid #e5e7eb; border-radius:14px; padding:12px; }
  .student-item{ display:flex; justify-content:space-between; align-items:center; padding:10px 8px; border-bottom:1px solid #f1f5f9; }
  .student-item:last-child{ border-bottom:none; }
  .student-name{ font-weight:900; }
  .no{ display:inline-block; width:28px; text-align:right; margin-right:8px; color:#6b7280; font-weight:900; }
  .student-actions{ display:flex; gap:10px; align-items:center; }
  .goto-btn{ text-decoration:none; font-weight:900; border:1px solid #d1d5db; padding:6px 10px; border-radius:10px; color:#111827; background:#fff; }
  .goto-btn:hover{ border-color:#9ca3af; }
  .status{ font-weight:950; font-size:13px; padding:4px 10px; border-radius:999px; border:1px solid #e5e7eb; }
  .status.done{ background:#ecfdf5; border-color:#a7f3d0; color:#065f46; }
  .status.todo{ background:#fff7ed; border-color:#fed7aa; color:#9a3412; }

  .btn-row{ display:flex; flex-wrap:wrap; gap:10px; margin-top:10px; }
  .action-btn{
    border:1px solid #d1d5db;
    background:#fff;
    color:#111827;
  }
  .action-btn:hover{ border-color:#9ca3af; }
  .action-btn.primary{ background:#4a6cf7; color:#fff; border-color:#4a6cf7; }
  .action-btn.primary:hover{ background:#3955c6; border-color:#3955c6; }

  /* í´ë¦­ì€ ë˜ì§€ë§Œ ë¹„í™œì„±ì²˜ëŸ¼ ë³´ì´ê²Œ (ëª¨ë‹¬ìš©) */
  .action-btn.is-disabled{
    opacity:0.45;
    cursor:not-allowed;
  }

  .action-btn.active{
    border-color:#111827;
    box-shadow: 0 0 0 1px #111827 inset;
  }
  .action-btn.primary.active{
    box-shadow: 0 0 0 1px rgba(17,24,39,0.25) inset;
  }

  .mini-card{ border:1px solid #e5e7eb; border-radius:14px; background:#fff; padding:12px; margin-top:10px; }
  .field-row{ display:flex; gap:10px; align-items:center; flex-wrap:wrap; margin-top:8px; }
  .reason-input{ flex:1; min-width:220px; }
  .small{ font-size:12px; color:#6b7280; font-weight:700; }

  button.pill, button.icon-btn, button.action-btn{ padding:10px 14px; border-radius:999px; font-size:14px; font-weight:900; }
  button.icon-btn{ padding:0; border-radius:10px; }
  button.action-btn{ border-radius:12px; padding:10px 14px; }

  .card.card-wide{ max-width:980px; }

  .dl-row{
    margin-top:12px;
    padding-top:12px;
    border-top:1px solid #eef2f7;
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:10px;
    flex-wrap:wrap;
  }
  .dl-hint{
    font-size:12px;
    color:#6b7280;
    font-weight:800;
    line-height:1.35;
  }
  .dl-pill{
    display:inline-flex;
    align-items:center;
    justify-content:center;
    gap:10px;
    padding:10px 14px;
    border-radius:12px;
    border:1px solid #d1d5db;
    background:#fff;
    color:#111827;
    font-weight:900;
    text-decoration:none;
    white-space:nowrap;
  }
  .dl-pill:hover{ border-color:#9ca3af; }
  .dl-pill svg{ width:18px; height:18px; flex:0 0 auto; }

  /* ------------------------------
     Minimal modal (1-line message)
  ------------------------------ */
  .modal-backdrop{
    position:fixed;
    inset:0;
    background:rgba(17,24,39,0.45);
    display:none;
    align-items:center;
    justify-content:center;
    z-index:2000;
    padding:16px;
  }
  .modal-backdrop.show{ display:flex; }

  .modal{
    width:min(420px, 100%);
    background:#fff;
    border-radius:16px;
    border:1px solid #e5e7eb;
    box-shadow:0 10px 30px rgba(0,0,0,0.18);
    overflow:hidden;
    text-align:left;
  }
  .modal-hd{
    padding:12px 14px;
    background:#f8fafc;
    border-bottom:none;
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:10px;
  }
  .modal-title{ font-weight:950; }
  .modal-close{
    width:34px; height:34px;
    border-radius:10px;
    border:1px solid #e5e7eb;
    background:#fff;
    cursor:pointer;
    font-weight:900;
  }
  .modal-bd{ padding:14px; }
  .modal-actions{
    padding:12px 14px;
    border-top:1px solid #eef2f7;
    display:flex;
    justify-content:flex-end;
    gap:10px;
    flex-wrap:wrap;
  }
</style>

<div class="card card-wide">
  <h2 style="margin:0 0 6px 0; text-align:center;">{{ cls.name }}</h2>
  <p style="margin:0 0 14px 0; text-align:center;">í•™ê¸‰ ì½”ë“œ: <b>{{ code }}</b></p>

  <div style="font-weight:900; text-align:center; margin:0 0 8px 0;">ì¸¡ì • íšŒì°¨ ì„ íƒ</div>

  {% set rounds = [("1","3ì›” ë§"), ("2","4ì›” ë§"), ("3","5ì›” ë§"), ("4","6ì›” ë§")] %}
  <div class="round-row">
    {% for n, when in rounds %}
      <div
        class="round-pill {% if open_panel and (sid|string)==(n|string) %}active{% endif %}"
        data-open-href="/teacher/class/{{ code }}/v2?sid={{ n }}&open=1"
        role="button"
        tabindex="0"
        title="{{ n }}ì°¨ ì¡°ì‚¬ ì—´ê¸°"
      >
        <div class="round-title">{{ n }}íšŒì°¨</div>
        <div class="round-sub">{{ when }}</div>

        <a
          class="round-result-btn"
          href="/teacher/class/{{ code }}/analysis?sid={{ n }}"
          target="_blank"
          rel="noopener noreferrer"
          title="{{ n }}ì°¨ ê²°ê³¼ ë³´ê¸°"
          onclick="event.stopPropagation();"
        >ê²°ê³¼<br>ë³´ê¸°</a>
      </div>
    {% endfor %}
  </div>


  {% if open_panel %}
  <div class="panel" id="roundPanel">
    <div class="panel-hd">
      <div>
        <div class="panel-title">{{ sid }}ì°¨ ì¡°ì‚¬</div>
        <div class="panel-sub">ì•„ë˜ ë‹¨ê³„ë³„ ë²„íŠ¼ì„ ëˆŒëŸ¬ í•„ìš”í•œ ë‚´ìš©ì„ í™•ì¸í•˜ì„¸ìš”.</div>
      </div>
      <div class="panel-sub">ì„ íƒ íšŒì°¨: <b>{{ sid }}íšŒì°¨</b></div>
    </div>

    <div class="panel-bd">
      <div class="step-row" role="tablist" aria-label="ì¡°ì‚¬ ë‹¨ê³„">
        <button type="button" class="pill step-btn active" data-step="guide" aria-selected="true">ì¡°ì‚¬ ì•ˆë‚´</button>
        <span class="step-arrow" aria-hidden="true">â†’</span>
        <button type="button" class="pill step-btn" data-step="teacher_map" aria-selected="false">êµì‚¬ ê´€ê³„ ì¸ì‹ ë°°ì¹˜</button>
        <span class="step-arrow" aria-hidden="true">â†’</span>
        <button type="button" class="pill step-btn" data-step="student_map" aria-selected="false">í•™ìƒ ì¸ì‹ ë°°ì¹˜</button>
        <span class="step-arrow" aria-hidden="true">â†’</span>
        <button type="button" class="pill step-btn" data-step="finalize" aria-selected="false">íšŒì°¨ ë§ˆë¬´ë¦¬</button>
      </div>

      {# --------------- ì¡°ì‚¬ ì•ˆë‚´ --------------- #}
      <div class="content-box active" data-step-box="guide">
        <div class="section-title">ë‹¤ìŒê³¼ ê°™ì´ í•™ìƒë“¤ì—ê²Œ ì•ˆë‚´í•´ì£¼ì„¸ìš”.</div>
        <div class="subtitle">
          ì§€ê¸ˆë¶€í„° í•˜ëŠ” í™œë™ì€ ìš°ë¦¬ ë°˜ ì¹œêµ¬ë“¤ì— ëŒ€í•´ ì—¬ëŸ¬ë¶„ì´ ëŠë¼ëŠ” <b>ê´€ê³„ì˜ ëŠë‚Œê³¼ ê±°ë¦¬ê°</b>ì„ ììœ ë¡­ê²Œ í‘œí˜„í•˜ëŠ” í™œë™ì…ë‹ˆë‹¤.<br>
          ì •ë‹µì´ë‚˜ í‹€ë¦° ë‹µì€ ì—†ìœ¼ë©°, ì˜ ë³´ì´ê²Œ í•˜ê±°ë‚˜ ìˆ¨ê²¨ì•¼ í•  ë‹µë„ ì—†ìŠµë‹ˆë‹¤.<br>
          ì§€ê¸ˆ ì‹œì ì—ì„œ ë– ì˜¤ë¥´ëŠ” ëŠë‚Œì„ ê¸°ì¤€ìœ¼ë¡œ, ë¶€ë‹´ ì—†ì´ ìš°ë¦¬ ë°˜ ì¹œêµ¬ë“¤ì„ ë°°ì¹˜í•´ ì£¼ì„¸ìš”.
        </div>

        <div class="note">
          â€» ì¥ë‚œì‹ìœ¼ë¡œ ì‘ë‹µí•˜ì§€ ì•Šê¸°<br>
          â€» ì…ë ¥ ê²°ê³¼ëŠ” ë‹¤ë¥¸ í•™ìƒë“¤ì—ê²Œ <b>ì ˆëŒ€ ê³µê°œë˜ì§€ ì•Šìœ¼ë‹ˆ</b> ì†”ì§í•˜ê²Œ ì‘ì„±í•´ë„ ê´œì°®ì•„ìš”.
        </div>
      </div>

      {# --------------- êµì‚¬ ê´€ê³„ ì¸ì‹ ë°°ì¹˜ --------------- #}
      <div class="content-box" data-step-box="teacher_map">
        <div class="section-title">êµì‚¬ ê´€ê³„ ì¸ì‹ ë°°ì¹˜</div>
        <div class="subtitle" style="margin-bottom:10px;">
          êµì‚¬ ê´€ê³„ ì¸ì‹ ë°°ì¹˜ëŠ” <b>í•´ë‹¹ íšŒì°¨ì˜ í•™ìƒ ì¸ì‹ ë°°ì¹˜ë³´ë‹¤ ë¨¼ì € ì§„í–‰</b>í•´ ì£¼ì„¸ìš”.<br><br>
          ì •ë‹µì„ ì°¾ê±°ë‚˜ í•™ìƒì„ íŒë‹¨Â·ì§„ë‹¨í•˜ê¸° ìœ„í•œ ê²ƒì´ ì•„ë‹™ë‹ˆë‹¤.<br>
          êµì‚¬ì˜ ê´€ì°°ì„ ì •ë¦¬í•´ ë³´ê³ , í•™ê¸‰ ê´€ê³„ë¥¼ ë‹¤ë¥¸ ê°ë„ì—ì„œ ë°”ë¼ë³´ê¸° ìœ„í•œ <b>ì°¸ê³  ìë£Œ</b>ì…ë‹ˆë‹¤.<br><br>
          ë§ê³  í‹€ë¦° ê²Œ ì—†ìœ¼ë‹ˆ ë¶€ë‹´ ì—†ì´ ë– ì˜¤ë¥´ëŠ” ëŒ€ë¡œ í•™ìƒë“¤ì„ ë°°ì¹˜í•´ ì£¼ì„¸ìš”.
        </div>

        <div class="btn-row">
          <a
            class="pill action-btn primary"
            href="/teacher/class/{{ code }}/placement/start?sid={{ sid }}"
            target="_blank"
            rel="noopener noreferrer"
            style="text-decoration:none;"
          >êµì‚¬ ê´€ê³„ ì¸ì‹ ë°°ì¹˜ ì‹œì‘ (ìƒˆ íƒ­)</a>
        </div>
      </div>

      {# --------------- í•™ìƒ ì¸ì‹ ë°°ì¹˜ --------------- #}
      <div class="content-box" data-step-box="student_map">
        <div class="section-title">í•™ìƒ ì¸ì‹ ë°°ì¹˜</div>
        <div class="subtitle" style="margin-bottom:10px;">
          QRì„ í•™ìƒë“¤ì—ê²Œ ë³´ì—¬ì£¼ê³ , í•™ìƒ ë¡œê·¸ì¸ PINì„ ì¸ì‡„í•˜ì—¬ ë°°ë¶€í•´ì£¼ì„¸ìš”. í•™ìƒ ì¡°ì‚¬ëŠ” íƒœë¸”ë¦¿ í™˜ê²½ì„ ê¶Œì¥í•©ë‹ˆë‹¤.
        </div>

        <div class="two-col">
          {% set qr_src = '/qr/' ~ code ~ '/' ~ sid ~ '.png' %}

          <div class="qr-box">
            <div style="font-weight:950; margin-bottom:6px;">{{ sid }}ì°¨ QR</div>
            <img
              src="{{ qr_src }}"
              alt="{{ sid }}ì°¨ QR"
              style="width:140px; height:140px; border-radius:10px; border:1px solid #eef2f7; display:block; margin:0 auto;"
              loading="lazy"
            />
            <div class="qr-actions">
              <button type="button" class="icon-btn" title="í¬ê²Œ ë³´ê¸°" onclick="openQrNewWindowOnly('{{ qr_src }}')">ğŸ”</button>
              <button type="button" class="icon-btn" title="ë‹¤ìš´ë¡œë“œ" onclick="downloadQrPng('{{ qr_src }}', '{{ sid }}ì°¨')">ğŸ“‚</button>
            </div>

            <br>

            <a
              class="pill action-btn"
              href="/teacher/class/{{ code }}/student_pin_pdf?sid={{ sid }}"
              style="text-decoration:none; display:inline-flex; align-items:center; gap:8px;"
              title="í•™ìƒ ë¡œê·¸ì¸ PIN PDF ë‹¤ìš´ë¡œë“œ"
            >
              <span>í•™ìƒ_ë¡œê·¸ì¸_PIN.pdf</span>
              <svg
                stroke="currentColor"
                fill="currentColor"
                stroke-width="0"
                viewBox="0 0 512 512"
                xmlns="http://www.w3.org/2000/svg"
                style="width:18px; height:18px; display:block;"
                aria-hidden="true"
                focusable="false"
              >
                <path d="M416 199.5h-91.4V64H187.4v135.5H96l160 158.1 160-158.1zM96 402.8V448h320v-45.2H96z"></path>
              </svg>
            </a>
          </div>

          <div class="student-list">
            <div style="font-weight:950; margin-bottom:8px;">í•™ìƒ ì°¸ì—¬ í˜„í™©</div>
            <div class="small" style="margin-bottom:10px;">í™”ì‚´í‘œ(â†—)ë¥¼ ëˆ„ë¥´ë©´ í•´ë‹¹ í•™ìƒ ê²°ê³¼ í™”ë©´ìœ¼ë¡œ ì´ë™í•©ë‹ˆë‹¤.</div>

            {% for r in rows %}
              <div class="student-item">
                <div class="student-name"><span class="no">{{ r.no }}</span> {{ r.name }}</div>
                <div class="student-actions">
                  <span class="status {% if r.status=='ì™„ë£Œ' %}done{% else %}todo{% endif %}">{{ r.status }}</span>
                  <a class="goto-btn" href="/teacher/class/{{ code }}/result/{{ sid }}/{{ r.url_name }}" title="í•™ìƒ ê²°ê³¼ ë³´ê¸°">â†—</a>
                </div>
              </div>
            {% endfor %}


          </div>
        </div>
      </div>

      {# --------------- íšŒì°¨ ë§ˆë¬´ë¦¬ --------------- #}
      <div class="content-box" data-step-box="finalize">
        <div class="section-title">íšŒì°¨ ë§ˆë¬´ë¦¬</div>

        {% set incomplete = rows | selectattr('status', 'equalto', 'ë¯¸ì™„ë£Œ') | list %}
        {% set incomplete_names = incomplete | map(attribute='name') | list %}

        <div class="btn-row">
          <button type="button" class="action-btn" id="btnExclude">ì°¸ì—¬ ì œì™¸ í•™ìƒ</button>

          <button
            type="button"
            class="action-btn is-disabled"
            id="btnSurvey"
            aria-disabled="true"
          >êµì‚¬ ì„¤ë¬¸</button>

          <button
            type="button"
            class="action-btn primary is-disabled"
            id="btnFinalize"
            aria-disabled="true"
          >ê²°ê³¼</button>

        </div>

        <div class="mini-card" id="boxExclude" style="display:none;">
          <div style="font-weight:950;">ì°¸ì—¬ ì œì™¸ í•™ìƒ</div>

          {% if incomplete_names|length == 0 %}
            <div class="small" style="margin-top:6px;">ë¯¸ì™„ë£Œ í•™ìƒì´ ì—†ìŠµë‹ˆë‹¤. ë‹¤ìŒ ë‹¨ê³„ë¡œ ì§„í–‰í•´ ì£¼ì„¸ìš”.</div>
            <div class="btn-row">
              <button type="button" class="action-btn" onclick="markExclusionResolved();">í™•ì¸</button>
            </div>
          {% else %}
            <div class="note" style="margin-top:10px;">
              <b>{{ incomplete_names|join(', ') }}</b> í•™ìƒì´ ë¯¸ì™„ë£Œí•˜ì˜€ìŠµë‹ˆë‹¤. ì°¸ì—¬ ì œì™¸í•˜ì‹œê² ìŠµë‹ˆê¹Œ?
            </div>

            <div class="btn-row">
              <button type="button" class="action-btn" id="btnExcludeYes">ì˜ˆ (ì‚¬ìœ  ì…ë ¥)</button>
              <button type="button" class="action-btn" id="btnExcludeNo">ì•„ë‹ˆìš” (í•™ìƒ ì°¸ì—¬ ì˜ˆì •)</button>
            </div>

            <div id="excludeReasons" style="display:none; margin-top:10px;">
              <div class="small">ë¯¸ì™„ë£Œ ì‚¬ìœ  ì˜ˆì‹œ: ê²°ì„, íŠ¹ìˆ˜í•™ìƒìœ¼ë¡œ ë³¸ì¸ ì°¸ì—¬ ì–´ë ¤ì›€ ë“±</div>
              {% for nm in incomplete_names %}
                <div class="field-row">
                  <div style="font-weight:900; min-width:120px;">{{ nm }}</div>
                  <input class="reason-input" type="text" placeholder="ì‚¬ìœ  ì…ë ¥" data-reason-for="{{ nm|e }}" />
                </div>
              {% endfor %}
            
              <div class="btn-row" style="justify-content:flex-start; margin-top:10px;">
                <button type="button" class="action-btn" id="btnExcludeSaveReasons">ì°¸ì—¬ ì œì™¸ ì‚¬ìœ  ì €ì¥</button>
              </div>
            </div>
          {% endif %}
        </div>

        <div class="mini-card" id="boxSurvey" style="display:none;">
          <div style="font-weight:950;">êµì‚¬ ì„¤ë¬¸</div>
          <div class="small" style="margin-top:6px;">
            ì•„ë˜ ì„¤ë¬¸ì€ ì´ë²ˆ íšŒì°¨ ê²°ê³¼ë¥¼ ë°”íƒ•ìœ¼ë¡œ, êµì‚¬ê°€ ëŠë‚€ í•™ê¸‰ ì´í•´ ë° íŒë‹¨ ê³¼ì •ì— ëŒ€í•œ ì˜ê²¬ì„ ë¬»ê¸° ìœ„í•œ ê²ƒì…ë‹ˆë‹¤.
            ì‘ë‹µ ë‚´ìš©ì€ ì—°êµ¬ ëª©ì ìœ¼ë¡œë§Œ ì‚¬ìš©ë˜ë©°, ê°œë³„ í•™ìƒ í‰ê°€ë‚˜ í–‰ì • ìë£Œë¡œ í™œìš©ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
          </div>

          <div style="margin-top:12px;">
            <div style="font-weight:900; margin:0 0 6px 0;">1) ì´ë²ˆ íšŒì°¨ì˜ ê´€ê³„ ì§€ë„ ê²°ê³¼ëŠ” í•™ê¸‰ ë‚´ êµìš°ê´€ê³„ë¥¼ ì´í•´í•˜ëŠ” ë° ë„ì›€ì´ ë˜ì—ˆìŠµë‹ˆê¹Œ?</div>
            <div class="field-row">
              {% for i in [1,2,3,4,5] %}
                <label style="display:inline-flex; align-items:center; gap:6px; font-weight:800;">
                  <input type="radio" name="q1_help" value="{{ i }}" style="width:auto;" /> {{ i }}
                </label>
              {% endfor %}
              <span class="small">(1=ì „í˜€ ì•„ë‹ˆë‹¤, 5=ë§¤ìš° ê·¸ë ‡ë‹¤)</span>
            </div>
          </div>

          <div style="margin-top:12px;">
            <div style="font-weight:900; margin:0 0 6px 0;">2) ì´ë²ˆ ê²°ê³¼ë¥¼ í†µí•´ ê¸°ì¡´ì— ì¸ì‹í•˜ì§€ ëª»í–ˆë˜ ê´€ê³„ë‚˜ ì§‘ë‹¨ êµ¬ì¡°ê°€ ìˆì—ˆìŠµë‹ˆê¹Œ?</div>
            <div class="field-row">
              <label style="display:inline-flex; align-items:center; gap:6px; font-weight:800;">
                <input type="radio" name="q2_new" value="yes" style="width:auto;" /> ìˆì—ˆë‹¤
              </label>
              <label style="display:inline-flex; align-items:center; gap:6px; font-weight:800;">
                <input type="radio" name="q2_new" value="no" style="width:auto;" /> ì—†ì—ˆë‹¤
              </label>
            </div>
            <textarea id="q2_detail" rows="3" placeholder="(ì„ íƒ) ìƒˆë¡­ê²Œ ì¸ì‹í•œ ê´€ê³„/êµ¬ì¡°ê°€ ìˆë‹¤ë©´ ê°„ë‹¨íˆ ì ì–´ ì£¼ì„¸ìš”." style="margin-top:8px;"></textarea>
          </div>

          <div style="margin-top:12px;">
            <div style="font-weight:900; margin:0 0 6px 0;">3) ì´ë²ˆ ê²°ê³¼ëŠ” í•™ìƒ ìƒë‹´/ìƒí™œì§€ë„ íŒë‹¨ ì‹œ ì°¸ê³  ìë£Œë¡œ í™œìš©í•  ìˆ˜ ìˆë‹¤ê³  ëŠë¼ì‹­ë‹ˆê¹Œ?</div>
            <div class="field-row">
              {% for i in [1,2,3,4,5] %}
                <label style="display:inline-flex; align-items:center; gap:6px; font-weight:800;">
                  <input type="radio" name="q3_use" value="{{ i }}" style="width:auto;" /> {{ i }}
                </label>
              {% endfor %}
              <span class="small">(1=ì „í˜€ ì•„ë‹ˆë‹¤, 5=ë§¤ìš° ê·¸ë ‡ë‹¤)</span>
            </div>
          </div>

          <div style="margin-top:12px;">
            <div style="font-weight:900; margin:0 0 6px 0;">4) ì´ë²ˆ ê²°ê³¼ëŠ” êµì‚¬ê°€ í‰ì†Œ ê°€ì§€ê³  ìˆë˜ ê´€ê³„ ì¸ì‹ê³¼ ë¹„êµí–ˆì„ ë•Œ ì–´ë–¤ í¸ì´ì—ˆìŠµë‹ˆê¹Œ?</div>
            <div class="field-row">
              <label style="display:inline-flex; align-items:center; gap:6px; font-weight:800;">
                <input type="radio" name="q4_cmp" value="similar" style="width:auto;" /> ëŒ€ë¶€ë¶„ ìœ ì‚¬í–ˆë‹¤
              </label>
              <label style="display:inline-flex; align-items:center; gap:6px; font-weight:800;">
                <input type="radio" name="q4_cmp" value="some" style="width:auto;" /> ì¼ë¶€ ì°¨ì´ê°€ ìˆì—ˆë‹¤
              </label>
              <label style="display:inline-flex; align-items:center; gap:6px; font-weight:800;">
                <input type="radio" name="q4_cmp" value="many" style="width:auto;" /> ìƒë‹¹í•œ ì°¨ì´ê°€ ìˆì—ˆë‹¤
              </label>
            </div>
            <textarea id="q4_detail" rows="3" placeholder="(ì„ íƒ) ì°¨ì´ê°€ ìˆì—ˆë‹¤ë©´ ì´ìœ ë‚˜ ì¸ìƒ ê¹Šì—ˆë˜ ì ì„ ì ì–´ ì£¼ì„¸ìš”." style="margin-top:8px;"></textarea>
          </div>

          <div style="margin-top:12px;">
            <div style="font-weight:900; margin:0 0 6px 0;">5) ì´ ë„êµ¬ë¥¼ ì‚¬ìš©í•˜ë©´ì„œ ê´€ê³„ íŒë‹¨ì— ëŒ€í•œ í™•ì‹ ë„ëŠ” ì–´ë–»ê²Œ ëŠê»´ì¡ŒìŠµë‹ˆê¹Œ?</div>
            <div class="field-row">
              <label style="display:inline-flex; align-items:center; gap:6px; font-weight:800;">
                <input type="radio" name="q5_conf" value="confused" style="width:auto;" /> ì˜¤íˆë ¤ í˜¼ë€ìŠ¤ëŸ¬ì› ë‹¤
              </label>
              <label style="display:inline-flex; align-items:center; gap:6px; font-weight:800;">
                <input type="radio" name="q5_conf" value="same" style="width:auto;" /> í° ë³€í™”ëŠ” ì—†ì—ˆë‹¤
              </label>
              <label style="display:inline-flex; align-items:center; gap:6px; font-weight:800;">
                <input type="radio" name="q5_conf" value="little" style="width:auto;" /> ì¡°ê¸ˆ ë” í™•ì‹ ì´ ìƒê²¼ë‹¤
              </label>
              <label style="display:inline-flex; align-items:center; gap:6px; font-weight:800;">
                <input type="radio" name="q5_conf" value="much" style="width:auto;" /> í™•ì‹¤íˆ ë„ì›€ì´ ë˜ì—ˆë‹¤
              </label>
            </div>
          </div>

          <div style="margin-top:12px;">
            <div style="font-weight:900; margin:0 0 6px 0;">6) (ì„ íƒ) ë‹¤ìŒ íšŒì°¨ì—ì„œë„ ì´ ë„êµ¬ë¥¼ í™œìš©í•  ì˜í–¥ì´ ìˆìœ¼ì‹­ë‹ˆê¹Œ?</div>
            <div class="field-row">
              <label style="display:inline-flex; align-items:center; gap:6px; font-weight:800;">
                <input type="radio" name="q6_next" value="yes" style="width:auto;" /> ìˆë‹¤
              </label>
              <label style="display:inline-flex; align-items:center; gap:6px; font-weight:800;">
                <input type="radio" name="q6_next" value="no" style="width:auto;" /> ì—†ë‹¤
              </label>
              <label style="display:inline-flex; align-items:center; gap:6px; font-weight:800;">
                <input type="radio" name="q6_next" value="maybe" style="width:auto;" /> ìƒí™©ì— ë”°ë¼ ë‹¤ë¥´ë‹¤
              </label>
            </div>
          </div>

          <div style="margin-top:12px;">
            <div style="font-weight:900; margin:0 0 6px 0;">7) (ì„ íƒ) ë¶ˆí¸í–ˆë˜ ì /ê°œì„ ë˜ì—ˆìœ¼ë©´ í•˜ëŠ” ì ì´ ìˆë‹¤ë©´ ì ì–´ ì£¼ì„¸ìš”.</div>
            <textarea id="q7_feedback" rows="3" placeholder="ììœ ë¡­ê²Œ ì‘ì„±" style="margin-top:8px;"></textarea>
          </div>

          <div class="btn-row">
            <button type="button" class="action-btn primary" id="btnSurveySubmit">ì„¤ë¬¸ ì œì¶œ</button>
            <span class="small" id="surveyHint">ì„¤ë¬¸ ì œì¶œ í›„ â€˜ê²°ê³¼ ì €ì¥â€™ ë²„íŠ¼ì´ í™œì„±í™”ë©ë‹ˆë‹¤.</span>
          </div>
        </div>

        <div class="mini-card" id="boxFinalize" style="display:none;">
          <div style="font-weight:950;">ê²°ê³¼ ì €ì¥</div>
          <div class="small" style="margin-top:6px;">ê²°ê³¼ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤. ê°ì‚¬í•©ë‹ˆë‹¤.</div>
          <div class="btn-row">
            <a class="pill action-btn primary" href="#" style="text-decoration:none;">ê²°ê³¼ í™”ë©´ ë³´ê¸°</a>
          </div>
        </div>

      </div>
    </div>
  </div>
  {% endif %}
</div>

<!-- Minimal modal -->
<div class="modal-backdrop" id="gateModal" aria-hidden="true">
  <div class="modal" role="dialog" aria-modal="true" aria-labelledby="gateModalTitle">
    <div class="modal-hd">
      <div class="modal-title" id="gateModalTitle">ì•ˆë‚´</div>
    </div>
    <div class="modal-bd" id="gateModalBody">ì„ í–‰ ë‹¨ê³„ë¥¼ ë¨¼ì € ì™„ë£Œí•´ì£¼ì„¸ìš”</div>
    <div class="modal-actions">
      <button type="button" class="action-btn primary" id="gateModalOk">í™•ì¸</button>
    </div>
  </div>
</div>

<script>
  // -------------------------------------------------
  // Step tabs (single-select: switch, not toggle)
  // -------------------------------------------------
  (function(){
    const stepBtns = Array.from(document.querySelectorAll('.step-btn'));
    const boxes = Array.from(document.querySelectorAll('.content-box'));
    function activate(step){
      stepBtns.forEach(b => {
        const on = b.dataset.step === step;
        b.classList.toggle('active', on);
        b.setAttribute('aria-selected', on ? 'true' : 'false');
      });
      boxes.forEach(x => x.classList.toggle('active', x.dataset.stepBox === step));
    }
    stepBtns.forEach(b => b.addEventListener('click', () => activate(b.dataset.step)));
  })();

  // -------------------------------------------------
  // Round pill click -> open session panel
  // (Result button has its own link and stops propagation)
  // -------------------------------------------------
  (function(){
    const pills = Array.from(document.querySelectorAll('.round-pill[data-open-href]'));
    pills.forEach(p => {
      p.addEventListener('click', () => {
        const href = p.getAttribute('data-open-href');
        if (href) window.location.href = href;
      });
      p.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' || e.key === ' ') {
          e.preventDefault();
          const href = p.getAttribute('data-open-href');
          if (href) window.location.href = href;
        }
      });
    });
  })();

  // -------------------------------------------------
  // QR actions
  // -------------------------------------------------
  function safeFilename(s){
    return (s || '')
      .trim()
      .replace(/[\\\/:*?"<>|]/g, '')
      .replace(/\s+/g, '_');
  }

  function openQrNewWindowOnly(src){
    const w = window.open(src, '_blank', 'noopener,noreferrer');
    if (!w) alert('ìƒˆ ì°½ì´ ì°¨ë‹¨ë˜ì–´ QRì„ ì—´ ìˆ˜ ì—†ì–´ìš”. ë¸Œë¼ìš°ì €ì—ì„œ íŒì—…ì„ í—ˆìš©í•œ ë’¤ ë‹¤ì‹œ ëˆŒëŸ¬ì£¼ì„¸ìš”.');
  }

  async function downloadQrPng(src, label){
    try {
      const res = await fetch(src, { cache: 'no-store' });
      if (!res.ok) throw new Error('QR fetch failed: ' + res.status);
      const blob = await res.blob();
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `qr_${safeFilename(label) || 'qr'}.png`;
      document.body.appendChild(a);
      a.click();
      a.remove();
      URL.revokeObjectURL(url);
    } catch (err) {
      window.open(src, '_blank', 'noopener,noreferrer');
    }
  }


  // -------------------------------------------------
  // Minimal modal helpers
  // -------------------------------------------------
  (function(){
    const modal = document.getElementById('gateModal');
    const btnOk = document.getElementById('gateModalOk');

    function close(){
      if (!modal) return;
      modal.classList.remove('show');
      modal.setAttribute('aria-hidden', 'true');
    }

    window.openGateModal = function(message){
      if (!modal) return;
      const body = document.getElementById('gateModalBody');
      if (body) body.textContent = message || 'ì„ í–‰ ë‹¨ê³„ë¥¼ ë¨¼ì € ì™„ë£Œí•´ì£¼ì„¸ìš”';
      modal.classList.add('show');
      modal.setAttribute('aria-hidden', 'false');
      // focus
      if (btnOk) btnOk.focus();
    };

    if (btnOk) btnOk.addEventListener('click', close);

    if (modal) {
      modal.addEventListener('click', (e) => {
        if (e.target === modal) close();
      });
    }

    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') close();
    });
  })();

  // -------------------------------------------------
  // Finalize flow (server-connected, v2)
  // Guarded by roundPanel + SID (prevents API calls when open_panel is off)
  // -------------------------------------------------
  (function(){
    const CODE = "{{ code }}";
    const SID = "{{ sid }}";

    const roundPanel = document.getElementById('roundPanel');
    if (!roundPanel || !SID) return;

    const API_BASE = `/api/v2/class/${CODE}/session/${SID}`;

    const btnExclude = document.getElementById('btnExclude');
    const btnSurvey = document.getElementById('btnSurvey');
    const btnFinalize = document.getElementById('btnFinalize');

    const boxExclude = document.getElementById('boxExclude');
    const boxSurvey = document.getElementById('boxSurvey');
    const boxFinalize = document.getElementById('boxFinalize');

    const btnExcludeYes = document.getElementById('btnExcludeYes');
    const btnExcludeNo = document.getElementById('btnExcludeNo');
    const excludeReasons = document.getElementById('excludeReasons');

    const btnSurveySubmit = document.getElementById('btnSurveySubmit');

    let exclusionResolved = false;
    let surveySubmitted = false;
    let finalized = false;

    const GATE_MSG = 'ì„ í–‰ ë‹¨ê³„ë¥¼ ë¨¼ì € ì™„ë£Œí•´ì£¼ì„¸ìš”';

    function setActive(btn, on){
      if (!btn) return;
      btn.classList.toggle('active', !!on);
      btn.setAttribute('aria-pressed', on ? 'true' : 'false');
    }

    function setAriaEnabled(btn, enabled){
      if (!btn) return;
      const on = !!enabled;
      btn.setAttribute('aria-disabled', on ? 'false' : 'true');
      btn.classList.toggle('is-disabled', !on);
    }

    function updateGates(){
      // survey is enabled only after exclusion resolved
      setAriaEnabled(btnSurvey, exclusionResolved);

      // finalize enabled only after survey submitted
      setAriaEnabled(btnFinalize, surveySubmitted);
    }

    async function apiGetState(){
      const res = await fetch(`${API_BASE}/state`, { cache: 'no-store' });
      const data = await res.json();
      if (!data || !data.ok) return null;
      return data;
    }

    async function apiPost(path, payload){
      const res = await fetch(`${API_BASE}/${path}`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload || {})
      });
      const data = await res.json().catch(() => ({}));
      if (!res.ok) {
        const msg = (data && data.error) ? data.error : `HTTP ${res.status}`;
        throw new Error(msg);
      }
      return data;
    }

    function toggleBox(btn, box){
      if (!btn || !box) return;
      const show = (box.style.display === 'none' || box.style.display === '');
      box.style.display = show ? 'block' : 'none';
      setActive(btn, show);
    }
    function allReasonsFilled(){
      if (!excludeReasons) return true;
      const inputs = Array.from(excludeReasons.querySelectorAll('input[data-reason-for]'));
      if (inputs.length === 0) return true;
      return inputs.every(i => (i.value || '').trim().length > 0);
    }

    
    function escapeHtml(s){
      return String(s || '')
        .replace(/&/g, '&amp;')
        .replace(/</g, '&lt;')
        .replace(/>/g, '&gt;')
        .replace(/"/g, '&quot;')
        .replace(/'/g, '&#39;');
    }
    
    function renderExcludedSummary(items){
      if (!boxExclude) return;
    
      const rows = (items || []).map(x => {
        const n = escapeHtml(x.student_name);
        const r = escapeHtml(x.reason);
        return `<div style="display:flex; gap:10px; align-items:flex-start; padding:8px 0; border-bottom:1px solid #eef2f7;">
                  <div style="font-weight:950; min-width:120px;">${n}</div>
                  <div style="font-weight:800; color:#374151; line-height:1.35;">${r}</div>
                </div>`;
      }).join('');
    
      boxExclude.innerHTML = `
        <div style="font-weight:950;">ì°¸ì—¬ ì œì™¸ í•™ìƒ</div>
        <div style="margin-top:10px; border:1px solid #eef2f7; border-radius:12px; padding:10px; background:#fff;">
          ${rows || '<div class="small">ì €ì¥ëœ í•­ëª©ì´ ì—†ìŠµë‹ˆë‹¤.</div>'}
        </div>
        <div class="small" style="margin-top:10px;">ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.</div>
      `;
    }


const btnExcludeSaveReasons = document.getElementById('btnExcludeSaveReasons');
if (btnExcludeSaveReasons) {
  btnExcludeSaveReasons.addEventListener('click', async () => {
    if (!excludeReasons){
      alert('ì‚¬ìœ  ì…ë ¥ ì˜ì—­ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
      return;
    }

    if (!allReasonsFilled()){
      alert('ëª¨ë“  í•™ìƒì˜ ì‚¬ìœ ë¥¼ ì…ë ¥í•´ ì£¼ì„¸ìš”.');
      return;
    }

    const inputs = Array.from(excludeReasons.querySelectorAll('input[data-reason-for]'));
    const items = inputs.map(i => ({
      student_name: i.getAttribute('data-reason-for'),
      reason: (i.value || '').trim()
    }));

    try{
      await apiPost('exclusions', { mode: 'exclude', items });

      exclusionResolved = true;
      updateGates();

      excludeReasons.style.display = 'none';

      renderExcludedSummary(items);

      boxExclude.style.display = 'block';
      setActive(btnExclude, true);
    }catch(e){
      alert('ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ìƒˆë¡œê³ ì¹¨ í›„ ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.');
    }
  });
}


    async function refreshFromServer(){
      try{
        const st = await apiGetState();
        if (!st) return;

        exclusionResolved = !!st.exclusions_resolved;
        surveySubmitted = !!st.survey_submitted;
        finalized = !!st.finalized;

        updateGates();

        // âœ… ì´ë¯¸ ì €ì¥ëœ exclusionsê°€ ìˆìœ¼ë©´, ì…ë ¥ UI ëŒ€ì‹  "ì €ì¥ ì™„ë£Œ ìš”ì•½"ìœ¼ë¡œ ì¦‰ì‹œ ë Œë”
        if (exclusionResolved && Array.isArray(st.exclusions_items) && st.exclusions_items.length > 0){
          if (excludeReasons) excludeReasons.style.display = 'none';
          renderExcludedSummary(st.exclusions_items);

          // ì°¸ì—¬ ì œì™¸ ë°•ìŠ¤ê°€ ì—´ë ¤ìˆë“  ì•„ë‹ˆë“ , ì—´ë©´ ë°”ë¡œ ìš”ì•½ì´ ë³´ì´ë„ë¡ ìœ ì§€
          if (boxExclude && (boxExclude.style.display === 'block')) {
            // already open: keep
          }
        }

      } catch(e){
        // silent
      }
    }


    // Exclude panel open/close
    if (btnExclude) {
      btnExclude.addEventListener('click', () => toggleBox(btnExclude, boxExclude));
    }

    // When no incomplete students: confirm -> mark exclusion resolved on server
    window.markExclusionResolved = async function(){
      try{
        await apiPost('exclusions', { mode: 'no_exclude' });
        exclusionResolved = true;
        updateGates();
        if (boxExclude) boxExclude.style.display = 'none';
        setActive(btnExclude, false);
        alert('í™•ì¸ë˜ì—ˆìŠµë‹ˆë‹¤.');
      }catch(e){
        alert('ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ìƒˆë¡œê³ ì¹¨ í›„ ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.');
      }
    }

    // Exclusion decisions
    if (btnExcludeNo) {
      btnExcludeNo.addEventListener('click', async () => {
        try{
          await apiPost('exclusions', { mode: 'no_exclude' });
          exclusionResolved = true;
          if (excludeReasons) excludeReasons.style.display = 'none';
          updateGates();
          window.openGateModal('í™•ì¸í–ˆìŠµë‹ˆë‹¤. í•™ìƒ ì°¸ì—¬ í›„ ë‹¤ì‹œ íšŒì°¨ ë§ˆë¬´ë¦¬í•´ì£¼ì„¸ìš”.');
        }catch(e){
          alert('ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ìƒˆë¡œê³ ì¹¨ í›„ ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.');
        }
      });
    }


    if (btnExcludeYes) {
      btnExcludeYes.addEventListener('click', () => {
        if (excludeReasons) excludeReasons.style.display = 'block';
        exclusionResolved = false;
        updateGates();
      });
    }
    
    if (excludeReasons) {
      excludeReasons.addEventListener('input', () => {
        exclusionResolved = allReasonsFilled();
        updateGates();
      });
    }

    // Survey panel: if disabled -> modal, else toggle
    if (btnSurvey) {
      btnSurvey.addEventListener('click', () => {
        const disabled = btnSurvey.getAttribute('aria-disabled') === 'true';
        if (disabled) return window.openGateModal(GATE_MSG);
        toggleBox(btnSurvey, boxSurvey);
      });
    }

    function getRadio(name){
      const el = document.querySelector(`input[name="${name}"]:checked`);
      return el ? el.value : null;
    }

    // Survey submit
    if (btnSurveySubmit) {
      btnSurveySubmit.addEventListener('click', async () => {
        const payload = {
          q1_help: getRadio('q1_help'),
          q2_new: getRadio('q2_new'),
          q2_detail: (document.getElementById('q2_detail') || {}).value || '',
          q3_use: getRadio('q3_use'),
          q4_cmp: getRadio('q4_cmp'),
          q4_detail: (document.getElementById('q4_detail') || {}).value || '',
          q5_conf: getRadio('q5_conf'),
          q6_next: getRadio('q6_next'),
          q7_feedback: (document.getElementById('q7_feedback') || {}).value || ''
        };

        try{
          await apiPost('survey', payload);
          surveySubmitted = true;
          updateGates();
          alert('ì„¤ë¬¸ì´ ì œì¶œë˜ì—ˆìŠµë‹ˆë‹¤.');
        }catch(e){
          alert('ì„¤ë¬¸ ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ìƒˆë¡œê³ ì¹¨ í›„ ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.');
        }
      });
    }

    // Finalize: if disabled -> modal, else proceed
    if (btnFinalize) {
      btnFinalize.addEventListener('click', async () => {
        const disabled = btnFinalize.getAttribute('aria-disabled') === 'true';
        if (disabled) return window.openGateModal(GATE_MSG);

        try{
          const res = await apiPost('finalize', {});
          finalized = true;
          updateGates();

          const fallbackUrl = `/teacher/class/${CODE}/analysis?sid=${SID}`;
          const resultUrl = (res && res.result_url) ? res.result_url : fallbackUrl;

          window.location.href = resultUrl;

        }catch(e){
          if (String(e.message) === 'NOT_READY'){
            window.openGateModal(GATE_MSG);
          } else {
            alert('ìµœì¢… ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ìƒˆë¡œê³ ì¹¨ í›„ ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.');
          }
        }
      });
    }


    refreshFromServer();
  })();
  
</script>

{% endblock %}
