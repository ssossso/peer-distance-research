{% extends "base.html" %}
{% block content %}
<div class="card" style="max-width:860px; text-align:left;">
  <h2 style="margin:0 0 10px 0; text-align:center;">교사 배치 기록 (마무리)</h2>

  <div class="muted" style="text-align:center; margin-bottom:14px;">
    <b>{{ run.teacher_username }}</b> · {{ run.session_id }}차 · 학급코드 <b>{{ run.class_code }}</b>
  </div>

  <div class="subtitle" style="margin-bottom:12px;">
    아래 항목은 연구 분석을 위한 보조 기록입니다. 정답/평가가 아니며, 교사의 관찰을 정리하기 위한 메모 성격입니다.
  </div>

  <form method="post" id="completeForm">
    <input type="hidden" name="duration_ms" id="duration_ms" value="0">

    <div style="border:1px solid #e5e7eb; border-radius:12px; padding:12px; background:#fafafa; margin-bottom:12px;">
      <div style="font-weight:800; margin-bottom:8px;">확신도(0~100)</div>
      <input type="number" name="confidence_score" min="0" max="100" value="0"
             style="width:140px; padding:8px 10px; border-radius:10px; border:1px solid #d1d5db;">
      <div class="muted" style="font-size:12px; margin-top:6px;">
        예: 0(전혀 확신 없음) ~ 100(매우 확신)
      </div>
    </div>

    <div style="border:1px solid #e5e7eb; border-radius:12px; padding:12px; background:#fafafa; margin-bottom:12px;">
      <div style="font-weight:800; margin-bottom:8px;">생활지도 개입 우선순위(선택, 최대 3명)</div>

      <datalist id="studentNames">
        {% for s in students %}
          <option value="{{ s.name }}"></option>
        {% endfor %}
      </datalist>

      <div style="display:grid; grid-template-columns: 120px 1fr; gap:10px; align-items:center;">
        <div style="font-weight:700;">1순위</div>
        <input name="priority_1" list="studentNames" placeholder="학생 이름 입력"
               style="padding:8px 10px; border-radius:10px; border:1px solid #d1d5db;">

        <div style="font-weight:700;">2순위</div>
        <input name="priority_2" list="studentNames" placeholder="학생 이름 입력"
               style="padding:8px 10px; border-radius:10px; border:1px solid #d1d5db;">

        <div style="font-weight:700;">3순위</div>
        <input name="priority_3" list="studentNames" placeholder="학생 이름 입력"
               style="padding:8px 10px; border-radius:10px; border:1px solid #d1d5db;">
      </div>

      <div class="muted" style="font-size:12px; margin-top:8px;">
        학생 이름은 자동완성 목록에서 선택할 수 있습니다. (공란 가능)
      </div>
    </div>

    <div style="display:flex; gap:8px;">
      <button type="submit" style="flex:1;">기록 저장 및 종료</button>
      <a class="btn" href="/teacher/class/{{ run.class_code }}?sid={{ run.session_id }}"
         style="flex:1; text-align:center; display:inline-flex; align-items:center; justify-content:center;">
        돌아가기
      </a>
    </div>
  </form>
</div>

<script>
  // 페이지 진입 시점부터 제출까지 시간 측정
  const startedAt = Date.now();
  document.getElementById('completeForm').addEventListener('submit', () => {
    const ms = Math.max(0, Date.now() - startedAt);
    document.getElementById('duration_ms').value = String(ms);
  });
</script>
{% endblock %}
